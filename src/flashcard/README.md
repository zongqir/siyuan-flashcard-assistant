# 闪卡快切功能

## 功能概述

闪卡快切是一个专为思源笔记闪卡系统设计的快捷筛选功能，旨在提高用户使用闪卡时的效率。

## 核心特性

### 🎯 智能筛选记录
- **自动记录**: 当用户通过"文件树"进行闪卡筛选时，自动记录选择
- **智能去重**: 同一个文档/笔记本多次筛选，只保留一条记录
- **使用统计**: 记录每个筛选项的使用次数，按频次智能排序

### 🏷️ 灵活管理
- **最多10条记录**: 保持列表简洁，避免混乱
- **固定功能**: 可以"钉住"常用筛选，避免被新记录挤掉
- **手动删除**: 支持删除不需要的历史记录

### 🎨 友好界面
- **小圆球浮窗**: 悬浮在页面右侧的快捷入口
- **扁平表格**: 清晰展示筛选历史，一键切换
- **拖拽支持**: 可以拖拽调整小圆球位置

## 技术架构

```
FlashcardQuickSwitchManager (主管理器)
├── FlashcardMonitor (闪卡筛选监听器)
├── HistoryManager (历史记录管理器)  
├── UIManager (界面管理器)
└── DataPersistence (数据持久化)
```

### 模块说明

#### FlashcardMonitor
- 监听思源闪卡面板的创建和筛选操作
- 自动识别筛选类型（文档/笔记本）
- 获取筛选目标的名称信息

#### HistoryManager  
- 管理筛选历史的增删改查
- 实现智能去重和排序逻辑
- 处理固定状态和使用统计

#### UIManager
- 创建和管理小圆球浮窗
- 渲染历史列表面板
- 处理用户交互事件

#### DataPersistence
- LocalStorage数据存储
- 插件卸载时自动清理
- 数据格式验证和迁移

## 使用方法

### 基本操作

1. **打开插件**: 在思源笔记中启用闪卡小助手插件
2. **查看快切球**: 会在页面右侧显示一个小圆球浮窗
3. **点击圆球**: 
   - 如果没有闪卡面板打开，会自动打开闪卡复习
   - 如果有闪卡面板，会弹出筛选历史面板
4. **选择筛选**: 点击历史记录中的任一项即可切换

### 高级功能

- **固定记录**: 点击📌图标固定常用筛选
- **删除记录**: 点击🗑️图标删除不需要的记录  
- **拖拽位置**: 按住小圆球拖拽到合适位置

## 数据结构

### 筛选记录格式
```typescript
interface FlashcardFilter {
    id: string;              // 文档ID或笔记本ID
    name: string;            // 显示名称
    type: 'doc' | 'notebook'; // 筛选类型
    useCount: number;        // 使用次数
    isPinned: boolean;       // 是否固定
    lastUsed: number;        // 最后使用时间戳
    createdAt: number;       // 创建时间戳
}
```

### 存储位置
数据存储在浏览器 LocalStorage 中，键名为 `flashcard-quick-switch`。

## 配置选项

```typescript
interface QuickSwitchConfig {
    enabled: boolean;           // 是否启用功能
    maxHistory: number;         // 最大历史记录数（默认10）
    ballPosition: {             // 小圆球位置
        x: number;
        y: number;
    };
    autoHide: boolean;          // 是否自动隐藏
    showUsageCount: boolean;    // 是否显示使用次数
    enableDrag: boolean;        // 是否支持拖拽
}
```

## 兼容性

- ✅ 支持思源笔记的闪卡对话框
- ✅ 支持闪卡Tab页面
- ✅ 桌面版和移动版兼容
- ✅ 支持暗黑主题

## 注意事项

1. **筛选限制**: 只记录通过"文件树"进行的具体筛选，不记录"全部"筛选
2. **数据清理**: 插件卸载时会自动清理相关数据
3. **容量限制**: 当10个位置都被固定时，无法添加新的筛选记录
4. **性能考虑**: 使用防抖机制避免频繁保存数据

## 开发信息

- 版本: 1.0.0
- 开发语言: TypeScript
- 依赖: 思源笔记API

## 更新日志

### v1.0.0
- 🎉 首次发布
- ✨ 基础的筛选记录和快切功能
- 🎨 小圆球浮窗和历史面板UI
- 📁 数据持久化和自动清理

